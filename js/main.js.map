{"version":3,"sources":["../../src/js/main.js"],"names":["API_DOMAIN_AVAILABLE","API_DOMAIN","Math","floor","random","length","WaitingTimesAPI","fallbackGeocodeAPI","geocodeAPI","geocodeAPIClient","logAPI","feedbackAPI","getPlaceByNameAPI","getPlacesAPI","getPlacesAPIFallback","searchSuggestAPI","format","str","args","slice","call","arguments","i","replace","CONTENT_CONSTANTS","HELP_MODAL","BODY","Number","prototype","toRad","PI","toDeg","Utils","updateTimeout","geoErrorTimeout","suggestTimeout","geoErrorFailOverCount","sendFeedback","body","fetch","method","headers","JSON","stringify","sendError","requestBody","navigator","userAgent","Date","toString","searchSuggest","el","clearTimeout","value","setTimeout","fetchUrl","r","parentEl","document","getElementById","innerHTML","noResult","ok","json","addresses","text","resultElement","createElement","className","setAttribute","appendChild","setDefaultLocation","address","lat","lng","obj","localStorage","setItem","getDefaultLocation","parse","getItem","shouldShowWelcomeModal","hasSeenWelcomeModal","window","showWelcomeModal","welcomeModal","classList","add","focus","TimesApp","querySelector","style","display","hideWelcomeModal","closeModal","initGeodata","filterSidebarList","filterSidebarTimeout","regexp","RegExp","items","querySelectorAll","title","getAttribute","search","showPlaceSidebar","placeSidebar","sidebarItemContainer","Object","keys","menuPlaces","key","place","waitTimeArr","formattedTime","undefined","date","hours","getHours","minutes","getMinutes","substr","waitTime","isClosed","noInfo","badgeText","itemTitle","toLowerCase","itemSubtitle","itemBadge","badgeBg","sidebarItem","showPlaceModal","place_id","placeModal","modalTitleEl","modalSubtitleEl","modalBadgeEl","timeMinEl","updateTimeEl","timeRangeEl","addEventListener","e","console","log","ESC_KEY","KEY_PRESSED","hidePlaceModal","update","remove","feedback","parseInt","getTime","setPlaceOnMap","openSuggestModal","removeChild","openModal","searchBySuggest","alert","searchByNameModal","searchByName","getPlace","id","content","actionText","actionFn","closeFn","h2","modal","tabIndex","modalInner","headerModal","containerContentDiv","buttonM","headerM","footer","closeButton","float","actionButton","getElementsByTagName","modalId","getAccurateCurrentPosition","geolocationSuccess","geolocationError","geoprogress","options","lastCheckedPosition","locationEventCount","watchID","timerID","checkLocation","position","coords","accuracy","desiredAccuracy","geolocation","clearWatch","foundPosition","stopTrying","onError","error","maxWait","timeout","maximumAge","enableHighAccuracy","watchPosition","destinationPoint","brng","dist","lat1","lon1","lat2","asin","sin","cos","lon2","atan2","isNaN","toggleLegend","distanceLatLng","R","dLat","dLon","a","c","sqrt","d","last_address","last_lat","last_lng","startBoundIndex","mapMarkers","parseFloat","zoom","lMap","myPosition","query","isLoading","place_ids","icons","fullEstimation","setLoading","b","initIcon","assetsPrefix","iconAssets","push","L","icon","iconUrl","iconSize","iconAnchor","popupAnchor","initMap","getPlaces","map","setView","tileLayer","maxZoom","minZoom","attribution","addTo","circle","color","fillColor","fillOpacity","radius","bindPopup","on","center","getCenter","type","updateAddress","updateBound","getPharmacies","showLegend","getMarkerPlaceColor","legend","control","onAdd","div","DomUtil","create","grades","labels","from","to","join","getWaitTime","hour","weekDay","getDay","maxTimeSpent","meanTimeSpent","minTimeSpent","max","min","reduce","cPopularity","waitTimes","popTimes","populartimes","meanIntersectPop","diffPopTimes","increase","ceil","q","ga","then","places","fireEvent","catch","url","singlePlace","message","getPlacesFallback","useFallback","Headers","append","placeUrl","pointMarkers","tmpMenuPlaces","colors","pointMarker","marker","indexOf","setIcon","removeEventListener","data","assign","updateAddressAwait","staddress","city","keyUrl","originLat","originLng","destLatLng","Promise","resolve","geoSuccess","geoError","toggleSpinner","latitude","longitude","showModalHelp","sendReview","rate","sendHelp","email","help","fallbackGeocodeCall","ask","prompt","latt","longt","promptAddress","p","spinnerEl","displayProp","mapEl","height","innerHeight","onerror","errorMessage","errorUrl","errorLine","ua","s","o","g","m","l","async","src","parentNode","insertBefore","serviceWorker","register"],"mappings":"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","sourcesContent":["const API_DOMAIN_AVAILABLE = ['api-geo-fr', 'api-geo-ny'];\nconst API_DOMAIN = API_DOMAIN_AVAILABLE[Math.floor(Math.random() * API_DOMAIN_AVAILABLE.length)];\nconst WaitingTimesAPI = {\n  fallbackGeocodeAPI: 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/findAddressCandidates?Address=%s&f=json',\n  geocodeAPI: 'https://api-geo.thejoin.tech/geocode?lat=%s&lng=%s',\n  geocodeAPIClient: 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/reverseGeocode?f=pjson&featureTypes=&location=%s,%s',\n  // geocodeAPI: 'https://geocode.xyz/%s,%s?json=1',\n  logAPI: 'https://api-geo.thejoin.tech/logger',\n  feedbackAPI: \"https://api-geo-fr.thejoin.tech/send-feedback\",\n  getPlaceByNameAPI: 'https://api-geo-ny.thejoin.tech/places/get-by-name?q=%s&address=%s',\n  // getPlacesAPI: 'https://api-geo-fr.thejoin.tech/places/explore?q=%s&address=%s&lat=%s&lng=%s',\n  getPlacesAPI: 'https://'+API_DOMAIN+'.thejoin.tech/places/explore?q=%s&address=%s',\n  getPlacesAPIFallback: 'https://api-geo-fr.thejoin.tech/places/explore-redis?q=%s&address=%s',\n  searchSuggestAPI: 'https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/suggest?text=%s&maxSuggestions=10&category=city,address&countryCode=&searchExtent=&location=&distance=&f=json',\n  format: function(str) {\n    var args = [].slice.call(arguments, 1),\n      i = 0;\n\n    return str.replace(/%s/g, () => args[i++]);\n  }\n};\n\nconst CONTENT_CONSTANTS = {\n  HELP_MODAL: {\n    BODY: `\n      <p>Didn't find what you were looking for? <br/><u style=\"cursor: pointer\" onclick=\"Utils.searchByNameModal()\">Tap here to search by name 🔍</u></p><input type=\"text\" id=\"email\" placeholder=\"Insert an email for an answer or leave blank\" /><textarea placeholder=\"Write here your question or tips\" rows=\"7\"></textarea><small><i>Note: this is not a search box</i></small>\n    `\n  }\n}\n\nNumber.prototype.toRad = function() {\n  return this * Math.PI / 180;\n}\n\nNumber.prototype.toDeg = function() {\n  return this * 180 / Math.PI;\n}\n\n// Lat, Lng, Angle, Range in Km => get point of destination\n// usage: destinationPoint(43.81, 11.13, 90, 10)\nconst Utils = {\n  updateTimeout: null,\n  geoErrorTimeout: null,\n  suggestTimeout: null,\n  geoErrorFailOverCount: 0,\n  sendFeedback: function (body) {\n    fetch(WaitingTimesAPI.feedbackAPI, {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body)\n    });\n  },\n  sendError: function(requestBody) {\n    requestBody[\"ua\"] = navigator.userAgent;\n    requestBody[\"date\"] = (new Date()).toString();\n\n    fetch(WaitingTimesAPI.logAPI, {\n      method: 'POST',\n      headers: {\n        'Accept': 'application/json',\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(requestBody)\n    });\n  },\n  searchSuggest: function(el) {\n    clearTimeout(Utils.suggestTimeout);\n    if (el.value.length >= 2) {\n      Utils.suggestTimeout = setTimeout(async function () {\n        var fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.searchSuggestAPI, el.value);\n        var r = await fetch(fetchUrl);\n        var parentEl = document.getElementById('suggest-results');\n        parentEl.innerHTML = \"\";\n        var noResult = true;\n\n        if (r.ok) {\n          var json = await r.json();\n          var addresses = [];\n          if (json[\"suggestions\"].length > 0) {\n            noResult = false;\n            for (var i in json[\"suggestions\"]) {\n              var text = json[\"suggestions\"][i][\"text\"].slice(0, -5);\n              var resultElement = document.createElement(\"div\");\n              resultElement.className = \"item-suggest-result\";\n              resultElement.setAttribute('onclick', \"document.getElementById('suggest-input').value = '\" + text +\"'; document.querySelector('#suggest-modal .container.teal .btn:nth-of-type(2)').click();\");\n              resultElement.innerHTML = text;\n              parentEl.appendChild(resultElement);\n            }\n          }\n        }\n\n        if (noResult)\n          parentEl.innerHTML = '<div class=\"item-suggest-result\">No results</div>';\n      }, 400);\n    }\n  },\n  setDefaultLocation: function(address, lat, lng) {\n    var obj = {\n      \"address\": address,\n      \"latt\": lat,\n      \"longt\": lng\n    };\n    localStorage.setItem(\"defaultLocation\", JSON.stringify(obj));\n  },\n  getDefaultLocation: function() {\n    return JSON.parse(localStorage.getItem(\"defaultLocation\"));\n  },\n  shouldShowWelcomeModal: function () {\n    var hasSeenWelcomeModal = window.localStorage.getItem(\"hasSeenWelcomeModal\");\n\n    if (hasSeenWelcomeModal) {\n      return hasSeenWelcomeModal === 'true' ? false : true;\n    }\n\n    return true;\n  },\n  showWelcomeModal: function () {\n    var welcomeModal = document.getElementById('welcome-modal');\n    welcomeModal.classList.add('show');\n    welcomeModal.focus();\n\n    if (TimesApp.address !== 'Firenze') {\n      // Hide the 'Get Started' button\n      document.querySelector('.welcome-modal__actions').style.display = \"none\";\n    }\n  },\n  hideWelcomeModal: function () {\n    Utils.closeModal('welcome-modal')\n    window.localStorage.setItem('hasSeenWelcomeModal', 'true');\n    if (TimesApp.address === 'Firenze')\n      TimesApp.initGeodata();\n  },\n  filterSidebarList: function(el) {\n    window.filterSidebarTimeout = window.filterSidebarTimeout || null;\n    clearTimeout(window.filterSidebarTimeout);\n\n    filterSidebarTimeout = setTimeout(function () {\n      var value = el.value;\n      var regexp = new RegExp(value, 'i');\n      var items = document.querySelectorAll(\".sidebar__item\");\n      for (var i = 0; i < items.length; i++) {\n        var title = items[i].getAttribute(\"title\");\n        if (title.search(regexp) === -1 && value.length >= 2) {\n          items[i].style.display = 'none';\n        } else {\n          items[i].style.display = 'block';\n        }\n      }\n    }, 400);\n  },\n  showPlaceSidebar: function () {\n    var placeSidebar = document.getElementById('places-sidebar');\n    placeSidebar.classList.add('show');\n    placeSidebar.focus();\n\n    document.getElementById('filter-sidebar').value = '';\n\n    // Reset list\n    var sidebarItemContainer = document.querySelector('.sidebar__items')\n    sidebarItemContainer.innerHTML = \"\";\n\n    if (Object.keys(TimesApp.menuPlaces).length > 0) {\n      for (var key in TimesApp.menuPlaces) {\n        var place = TimesApp.menuPlaces[key][\"data\"];\n        var waitTimeArr = TimesApp.menuPlaces[key][\"waitTimeArr\"];\n\n        var formattedTime = \"recent\";\n        if (place[\"updatetime\"] !== undefined) {\n          var date = new Date(place[\"updatetime\"] * 1000);\n          var hours = date.getHours();\n          var minutes = \"0\" + date.getMinutes();\n          formattedTime = hours + ':' + minutes.substr(-2);\n        }\n    \n        var waitTime = waitTimeArr[1];\n        var isClosed = (waitTimeArr[0] === 0) ? true : false;\n        var noInfo = (typeof(waitTime) === 'string' && !isClosed) ? true : false;\n        waitTime = (isClosed) ? \"Closed\" : waitTime;\n\n        var badgeText = (isClosed) ? \"Closed\" : (waitTime + \" min\");\n        badgeText = (noInfo) ? \"No info\" : badgeText;\n\n        var itemTitle = document.createElement(\"h2\");\n        itemTitle.className = \"sidebar__item--title sidebar__item--title--bg-\" + waitTime.toString().toLowerCase() + \"min\";\n        itemTitle.innerHTML = place[\"name\"];\n\n        var itemSubtitle = document.createElement(\"p\");\n        itemSubtitle.className = \"sidebar__item--subtitle\";\n        itemSubtitle.innerHTML = place[\"address\"];\n\n        var itemBadge = document.createElement(\"div\");\n        itemBadge.className = place[\"place_id\"] + \" sidebar__item--badge\";\n\n        var badgeBg = document.createElement(\"div\");\n        badgeBg.className = \"text-center bg-\" + waitTime.toString().toLowerCase() + \"min\";\n        badgeBg.innerHTML = \"<span>\" + badgeText + \"</span><br/>Last update <time>\" + formattedTime + \"</time>\";\n\n        itemBadge.appendChild(badgeBg);\n\n        var sidebarItem = document.createElement(\"div\");\n        sidebarItem.setAttribute(\"onclick\", \"TimesApp.mapMarkers['\"+key+\"'].fireEvent('click')\");\n        sidebarItem.className = \"sidebar__item\";\n        sidebarItem.setAttribute(\"title\", place[\"name\"] + \" \" + place[\"address\"] + \" - wait time: \" + waitTime + \"min\");\n\n        sidebarItem.appendChild(itemTitle);\n        sidebarItem.appendChild(itemSubtitle);\n        sidebarItem.appendChild(itemBadge);\n\n        sidebarItemContainer.appendChild(sidebarItem);\n      }\n    }\n  },\n  showPlaceModal: function (place_id) {\n    var place = TimesApp.menuPlaces[place_id][\"data\"];\n    var waitTimeArr = TimesApp.menuPlaces[place_id][\"waitTimeArr\"];\n    var placeModal = document.getElementById('place-modal');\n    placeModal.setAttribute(\"data-place-id\", place[\"place_id\"]);\n\n    var formattedTime = \"recent\";\n    if (place[\"updatetime\"] !== undefined) {\n      var date = new Date(place[\"updatetime\"] * 1000);\n      var hours = date.getHours();\n      var minutes = \"0\" + date.getMinutes();\n      formattedTime = hours + ':' + minutes.substr(-2);\n    }\n\n    var waitTime = waitTimeArr[1];\n    var isClosed = (waitTimeArr[0] === 0) ? true : false;\n    var noInfo = (typeof(waitTime) === 'string' && !isClosed) ? true : false;\n    waitTime = (isClosed) ? \"Closed\" : waitTime;\n\n    var modalTitleEl = document.querySelector(\".place-modal__title\");\n    modalTitleEl.innerHTML = place[\"name\"];\n    var modalSubtitleEl = document.querySelector(\".place-modal__subtitle\");\n    modalSubtitleEl.innerHTML = place[\"address\"];\n    var modalBadgeEl = document.querySelector(\".place-modal__badge div\");\n    var badgeText = (isClosed) ? \"Closed\" : (waitTime + \" min\");\n    badgeText = (noInfo) ? \"No info\" : badgeText;\n    modalBadgeEl.setAttribute(\"class\", \"text-center bg-\" + waitTime.toString().toLowerCase() + \"min\");\n    var timeMinEl = document.querySelector(\"#time-min\");\n    timeMinEl.innerHTML = badgeText;\n    var updateTimeEl = document.querySelector(\"#place-modal time\");\n    updateTimeEl.innerHTML = formattedTime;\n    var timeRangeEl = document.querySelector(\"#time-range\");\n    timeRangeEl.value = (typeof(waitTimeArr[1]) === 'string') ? 10 : waitTimeArr[1];\n\n    placeModal.addEventListener('keyup', (e) => {\n      console.log(e);\n      const ESC_KEY = 'Escape';\n      const KEY_PRESSED = e.key;\n\n      if (KEY_PRESSED === ESC_KEY) {\n        Utils.closeModal('place-modal');\n      }\n    });\n\n    placeModal.classList.add('show');\n    placeModal.focus();\n  },\n  hidePlaceModal: function (update) {\n    var update = update || false;\n    var placeModal = document.getElementById(\"place-modal\");\n    placeModal.classList.remove(\"show\");\n    if (update) {\n      var feedback = {\n        \"place_id\": placeModal.getAttribute(\"data-place-id\"),\n        \"value\": {\n          \"estimate_person\": 0,\n          \"estimate_wait_min\": parseInt(document.querySelector(\"#time-range\").value)\n        }\n      };\n      Utils.sendFeedback(feedback);\n\n      var place = TimesApp.menuPlaces[placeModal.getAttribute(\"data-place-id\")][\"data\"];\n      place[\"user_feedback\"] = feedback;\n      place[\"user_feedback\"][\"estimate_wait_min\"] = feedback[\"value\"][\"estimate_wait_min\"];\n      place[\"user_feedback\"][\"updatetime\"] = (new Date()).getTime() / 1000;\n      TimesApp.setPlaceOnMap([place]);\n\n      if (document.querySelector('.sidebar.show') !== null)\n        Utils.showPlaceSidebar();\n    }\n  },\n  openSuggestModal: function() {\n    if (document.querySelector('.modal') !== null)\n      document.body.removeChild(document.querySelector('.modal'));\n    \n    Utils.openModal(\n      \"suggest-modal\",\n      \"Search by address\",\n      '<input type=\"text\" autocomplete=\"off\" name=\"suggest-adr\" onkeydown=\"Utils.searchSuggest(this)\" placeholder=\"Insert your city or address\" id=\"suggest-input\"><div id=\"suggest-results\"></div>',\n      \"Search\",\n      function searchBySuggest() {\n        if (document.getElementById('suggest-input').value == '') {\n          alert(\"Please, specify a place name and a place address.\");\n          return false;\n        }\n\n        TimesApp.address = document.getElementById('suggest-input').value;\n        TimesApp.search(-1);\n        // suggest-input\n        document.body.removeChild(document.querySelector('.modal'));\n      }\n    );\n    document.getElementById('suggest-input').focus();\n  },\n  searchByNameModal: function() {\n    if (document.querySelector('.modal') !== null)\n      document.body.removeChild(document.querySelector('.modal'));\n    \n    Utils.openModal(\n      \"search-modal\",\n      \"Search by name and address\",\n      '<input type=\"text\" placeholder=\"Insert market or place name\" id=\"place\"><input type=\"text\" placeholder=\"Insert address or city\" id=\"address\">',\n      \"Search\",\n      function searchByName() {\n        if (document.getElementById('place').value == '' || document.getElementById('address').value == '') {\n          alert(\"Please, specify a place name and a place address.\");\n          return false;\n        }\n\n        TimesApp.getPlace(\n          document.getElementById('place').value,\n          document.getElementById('address').value\n        );\n        document.body.removeChild(document.querySelector('.modal'));\n      }\n    );\n  },\n  openModal: function(id, title, content, actionText, actionFn, closeFn) {\n    var id = id || (new Date()).getTime();\n    var h2 = title;\n    var actionText = actionText || 'Send';\n\n    var modal = document.createElement('div');\n    modal.id = id;\n    modal.className = 'modal show';\n    modal.tabIndex = '-1';\n    modal.setAttribute('role', 'dialog');\n    modal.setAttribute('aria-label', title);\n    modal.setAttribute('aria-modal', 'true');\n\n    modal.addEventListener('keyup', (e) => {\n      const ESC_KEY = 'Escape';\n      const KEY_PRESSED = e.key;\n\n      if (KEY_PRESSED === ESC_KEY) {\n        Utils.closeModal(id);\n      }\n    });\n\n    var modalInner = document.createElement('div');\n    modalInner.className = 'modal-content animate-opacity card-4';\n    modal.appendChild(modalInner);\n\n    var headerModal = document.createElement('div');\n    headerModal.className = 'container teal';\n    modalInner.appendChild(headerModal);\n\n    var containerContentDiv = document.createElement('div');\n    containerContentDiv.className = 'container';\n    modalInner.appendChild(containerContentDiv);\n\n    containerContentDiv.innerHTML = content || CONTENT_CONSTANTS.HELP_MODAL.BODY;\n\n    var buttonM = document.createElement(\"button\");\n    buttonM.setAttribute(\"type\", \"button\");\n    buttonM.className = 'close-button display-topright';\n    buttonM.setAttribute(\"onclick\", \"Utils.closeModal('\" + id + \"')\");\n    buttonM.innerHTML = \"&times; <span class='sr-only'>Close\" + title + \" modal</span>\";\n    headerModal.appendChild(buttonM);\n\n    var headerM = document.createElement(\"H2\");\n    headerM.innerHTML = h2;\n    headerModal.appendChild(headerM);\n\n    var footer = document.createElement('div');\n    footer.className = 'container teal';\n    modalInner.appendChild(footer);\n\n    var closeButton = document.createElement(\"button\");\n    closeButton.setAttribute('type', 'button');\n    closeButton.className = 'btn';\n    if (actionText !== -1)\n      closeButton.style.float = \"right\";\n\n    if (closeFn === undefined) {\n      closeButton.setAttribute(\"onclick\", \"Utils.closeModal('\" + id + \"')\");\n    } else {\n      closeButton.addEventListener('click', closeFn);\n    }\n\n    closeButton.innerHTML = \"Close\";\n    footer.appendChild(closeButton);\n\n    if (actionText !== -1) {\n      var actionButton = document.createElement(\"button\");\n      actionButton.setAttribute(\"type\", \"button\");\n      actionButton.className = 'btn';\n      if (actionFn === undefined) {\n        actionButton.setAttribute(\"onclick\", \"TimesApp.sendHelp(document.querySelector('.modal-content textarea').value, document.querySelector('.modal-content #email').value)\");\n      } else {\n        actionButton.addEventListener('click', actionFn);\n      }\n\n      actionButton.innerHTML = actionText;\n      footer.appendChild(actionButton);\n    }\n\n    document.getElementsByTagName('body')[0].appendChild(modal);\n    modal.focus();\n  },\n  closeModal: function(modalId) {\n    let modal = document.getElementById(modalId);\n    modal.classList.remove('show');\n  },\n  getAccurateCurrentPosition: function(geolocationSuccess, geolocationError, geoprogress, options) {\n    var lastCheckedPosition,\n      locationEventCount = 0,\n      watchID,\n      timerID;\n\n    options = options || {};\n\n    var checkLocation = function(position) {\n      lastCheckedPosition = position;\n      locationEventCount = locationEventCount + 1;\n      // We ignore the first event unless it's the only one received because some devices seem to send a cached\n      // location even when maxaimumAge is set to zero\n      if ((position.coords.accuracy <= options.desiredAccuracy) && (locationEventCount > 1)) {\n        clearTimeout(timerID);\n        navigator.geolocation.clearWatch(watchID);\n        foundPosition(position);\n      } else {\n        geoprogress(position);\n      }\n    };\n\n    var stopTrying = function() {\n      navigator.geolocation.clearWatch(watchID);\n      foundPosition(lastCheckedPosition);\n    };\n\n    var onError = function(error) {\n      clearTimeout(timerID);\n      navigator.geolocation.clearWatch(watchID);\n      geolocationError(error);\n    };\n\n    var foundPosition = function(position) {\n      geolocationSuccess(position);\n    };\n\n    if (!options.maxWait) options.maxWait = 10000; // Default 10 seconds\n    if (!options.desiredAccuracy) options.desiredAccuracy = 20; // Default 20 meters\n    if (!options.timeout) options.timeout = options.maxWait; // Default to maxWait\n\n    options.maximumAge = 0; // Force current locations only\n    options.enableHighAccuracy = true; // Force high accuracy (otherwise, why are you using this function?)\n\n    watchID = navigator.geolocation.watchPosition(checkLocation, onError, options);\n    timerID = setTimeout(stopTrying, options.maxWait); // Set a timeout that will abandon the location loop\n  },\n  destinationPoint: function(lat, lng, brng, dist) {\n    dist = dist / 6371;\n    brng = brng.toRad();\n\n    var lat1 = lat.toRad(),\n      lon1 = lng.toRad();\n\n    var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) +\n      Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));\n\n    var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) *\n      Math.cos(lat1),\n      Math.cos(dist) - Math.sin(lat1) *\n      Math.sin(lat2));\n\n    if (isNaN(lat2) || isNaN(lon2)) return null;\n\n    return [lat2.toDeg(), lon2.toDeg()];\n  },\n  toggleLegend: function (e) {\n    if (document.getElementById('legend-values').style.display == 'none') {\n      document.getElementById('legend-values').style.display = 'block';\n      e.innerHTML = 'Legend ▾';\n    } else {\n      document.getElementById('legend-values').style.display = 'none';\n      e.innerHTML = 'Legend ▴';\n    }\n  },\n  distanceLatLng: function(lat1, lon1, lat2, lon2) {\n    var R = 6371; // km\n    var dLat = (lat2 - lat1).toRad();\n    var dLon = (lon2 - lon1).toRad();\n    var lat1 = (lat1).toRad();\n    var lat2 = (lat2).toRad();\n\n    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    var d = R * c;\n    return d;\n  }\n};\n\nvar last_address = localStorage.getItem(\"last_address\");\nvar last_lat = localStorage.getItem(\"last_lat\");\nvar last_lng = localStorage.getItem(\"last_lng\");\n\nconst TimesApp = {\n  startBoundIndex: 361,\n  mapMarkers: {},\n  menuPlaces: {},\n  address: (last_address !== null) ? last_address : \"Firenze\",\n  lat: (last_lat !== null) ? parseFloat(last_lat) : 43.7740236,\n  lng: (last_lng !== null) ? parseFloat(last_lng) : 11.253233,\n  zoom: 15,\n  lMap: null,\n  myPosition: null,\n  query: \"supermarket\",\n  isLoading: false,\n  place_ids: [],\n  icons: [],\n  fullEstimation: true,\n  setLoading: function(b) {\n    TimesApp.isLoading = b;\n    var display = (b === true) ? 'block' : 'none';\n    document.getElementById('top-progress-bar').style.display = display;\n  },\n  initIcon: function() {\n    var assetsPrefix = \"/assets/custom-marker/\";\n    const iconAssets = ['0', '1', '2', '3', '4', '5', '6', '7', '8'];\n\n    for (const key in iconAssets) {\n      TimesApp.icons.push(L.icon({\n        iconUrl: assetsPrefix + iconAssets[key] + '.png',\n\n        iconSize: [42, 42], // size of the icon\n        iconAnchor: [20, 32], // point of the icon which will correspond to marker's location\n        popupAnchor: [2, -20] // point from which the popup should open relative to the iconAnchor\n      }));\n    }\n  },\n  initMap: function(getPlaces) {\n    var getPlaces = getPlaces || true;\n    TimesApp.initIcon();\n    TimesApp.lMap = L.map('full-map').setView([TimesApp.lat, TimesApp.lng], TimesApp.zoom);\n    L.tileLayer(\n      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n        maxZoom: 18,\n        minZoom: 11,\n        attribution: 'Map data <a href=\"https://openstreetmap.org\">OpenStreetMap</a> contributors',\n      }\n    ).addTo(TimesApp.lMap);\n\n    // TimesApp.lMap.zoomControl.remove();\n\n    TimesApp.myPosition = L.circle([TimesApp.lat, TimesApp.lng], {\n      color: '#0696c1',\n      fillColor: '#06aee0',\n      fillOpacity: 0.5,\n      radius: 50\n    }).bindPopup(\"Your position\").addTo(TimesApp.lMap);\n\n    TimesApp.lMap.on(\"moveend zoomend\", async function(e) {\n      clearTimeout(Utils.updateTimeout);\n      var center = TimesApp.lMap.getCenter();\n      console.log(\"new center \", center.toString());\n      console.log(e.type);\n      if (Utils.distanceLatLng(TimesApp.lat, TimesApp.lng, center.lat, center.lng) >= 2.5 || e.type == 'zoomend') {\n        Utils.updateTimeout = setTimeout(async function() {\n          TimesApp.lat = parseFloat(center.lat);\n          TimesApp.lng = parseFloat(center.lng);\n\n          await TimesApp.updateAddress(-1);\n          TimesApp.getPlaces(null, true);\n          await TimesApp.updateBound(TimesApp.lat, TimesApp.lng);\n          TimesApp.getPharmacies();\n\n          localStorage.setItem(\"last_address\", TimesApp.address);\n          localStorage.setItem(\"last_lat\", TimesApp.lat);\n          localStorage.setItem(\"last_lng\", TimesApp.lng);\n        }, 1000);\n      }\n\n    });\n\n    TimesApp.showLegend();\n    if (getPlaces === true)\n      TimesApp.getPlaces(null, true);\n  },\n  // getMarkerPlaceColor: function (d) {\n  //     return d > 60 ? ['#BD0026', '#cc0c33'] :\n  //         d > 45  ? ['#800026', '#ff2929'] :\n  //         d > 30  ? ['#e33c17', '#fa4c25'] :\n  //         d > 25  ? ['#de691b', '#fc7e2a'] :\n  //         d > 15   ? ['#e6a910', '#ffbf1c'] :\n  //         d > 10   ? ['#d9e30e', '#ecf716'] :\n  //                     ['#1dbd00', '#1fcc00'];\n  // },\n  getMarkerPlaceColor: function(d) {\n    return d > 60 ? [6, '#cc0c33'] :\n      d > 45 ? [5, '#ff2929'] :\n      d > 30 ? [4, '#fa4c25'] :\n      d > 25 ? [3, '#fc7e2a'] :\n      d > 15 ? [2, '#ffbf1c'] :\n      d > 10 ? [1, '#ecf716'] : [0, '#1fcc00'];\n  },\n  showLegend: function() {\n    var legend = L.control({\n      position: 'bottomleft'\n    });\n\n    legend.onAdd = function(map) {\n\n      var div = L.DomUtil.create('div', 'info legend'),\n        grades = [5, 10, 15, 25, 30, 45, 60],\n        labels = [],\n        from, to;\n\n      labels.push(\n        '<i style=\"background: #3f8ee2\"></i> No info'\n      );\n      \n      for (var i = 0; i < grades.length; i++) {\n        from = grades[i];\n        to = grades[i + 1];\n\n        labels.push(\n          '<i style=\"background:' + TimesApp.getMarkerPlaceColor(grades[i] + 1)[1] + '\"></i> ' +\n          from + (to ? '&ndash;' + to : '+'));\n      }\n\n      div.innerHTML = \"<span onclick=\\\"Utils.toggleLegend(this)\\\">Legend ▴</span><div style=\\\"display: none\\\" id=\\\"legend-values\\\"><u>Minutes</u>:<br>\" + labels.join('<br>') + \"</div>\";\n      return div;\n    };\n\n    legend.addTo(TimesApp.lMap);\n  },\n  getWaitTime: function(place) {\n    const hour = (new Date()).getHours();\n    const weekDay = ((new Date()).getDay() === 0) ? 6 : (new Date()).getDay() - 1;\n\n    var maxTimeSpent = 0;\n    var meanTimeSpent = 0;\n    var minTimeSpent = 0;\n\n    if (place[\"time_spent\"] !== undefined && place[\"time_spent\"].length > 0) {\n      place[\"time_spent\"][0] = (place[\"time_spent\"][0] == 1) ? 60 : place[\"time_spent\"][0];\n      place[\"time_spent\"][1] = (place[\"time_spent\"][1] == 1) ? 60 : place[\"time_spent\"][1];\n      maxTimeSpent = Math.max(...place[\"time_spent\"]);\n      minTimeSpent = Math.min(...place[\"time_spent\"]);\n      meanTimeSpent = (place[\"time_spent\"].reduce(function(a, b) {\n        return a + b;\n      }, 0)) / 2;\n    }\n\n    const cPopularity = place[\"current_popularity\"] || 0;\n\n    var waitTimes = 0;\n    var popTimes = 0;\n    var populartimes = 1;\n    if (place[\"time_wait\"] !== undefined && place[\"time_wait\"].length > 0)\n      waitTimes = place[\"time_wait\"][weekDay][\"data\"][hour];\n\n    if (place[\"populartimes\"] !== undefined) {\n      populartimes = popTimes = place[\"populartimes\"][weekDay][\"data\"][hour];\n      if ((new Date()).getMinutes() >= 40 && place[\"populartimes\"][weekDay][\"data\"][hour+1] !== undefined && place[\"populartimes\"][weekDay][\"data\"][hour+1] != 0)\n        popTimes = Math.floor((popTimes + place[\"populartimes\"][weekDay][\"data\"][hour+1]) / 2);\n    }\n    \n    var meanIntersectPop = 0;\n    const diffPopTimes = (popTimes - cPopularity);\n    var increase = (popTimes > 0) ? meanTimeSpent : 0;\n    if (cPopularity !== 0) {\n      if ((popTimes / cPopularity) <= 3.3) {\n        if (diffPopTimes <= 0 && waitTime > 10) {\n          increase = maxTimeSpent + (Math.ceil((cPopularity / 2) / 5) * 5);\n        } else if (diffPopTimes > 0 && diffPopTimes < (popTimes / 5)) {\n          increase = meanTimeSpent;\n        } else if (diffPopTimes >= (popTimes / 5) && diffPopTimes <= (popTimes / 2.9)) {\n          increase = minTimeSpent;\n        } else if (diffPopTimes > (popTimes / 2.9) && diffPopTimes <= (popTimes / 1.8)) {\n          increase = (Math.ceil((minTimeSpent / 2) / 5) * 5);\n        } else if (diffPopTimes > (popTimes / 1.8) && diffPopTimes <= (popTimes / 1.5)) {\n          increase = (Math.ceil((minTimeSpent / 3) / 5) * 5);\n        } else if (diffPopTimes > (popTimes / 1.5)) {\n          increase = 0;\n          waitTimes = (Math.ceil((waitTimes * 20 / 100) / 5) * 5);\n        }\n      } else {\n        if (cPopularity >= (popTimes / 3.3)) {\n          increase = minTimeSpent;\n        } else {\n          waitTimes = 0;\n          increase = 5;\n        }\n      }\n    } else if (waitTimes == 0) {\n      increase = 0;\n    } else if (cPopularity == 0 && TimesApp.fullEstimation == false) {\n      waitTime = 0;\n      increase = 0;\n    }\n\n    meanIntersectPop += increase;\n    var waitTime = (Math.ceil((waitTimes + meanIntersectPop) / 5) * 5);\n\n    if (popTimes !== 0 && cPopularity >= 18)\n      waitTime += 5; // relative error, white rumor\n\n    if (waitTime === 0 && (meanTimeSpent === 0 || cPopularity === 0))\n      waitTime = 'No information about ';\n\n    return [populartimes, waitTime];\n  },\n  getPharmacies: function() {\n    console.log(\"Getting pharmacy\");\n    // TimesApp.getPlaces(\"pharmacy\");\n  },\n  getPlace: function(q, address) {\n    TimesApp.setLoading(true);\n    const fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.getPlaceByNameAPI, q, address);\n    ga('send', 'event', 'Request', 'Place', (q + ' ' + address));\n    fetch(fetchUrl)\n      .then((r) => {\n        if (r.ok) return r.json();\n      })\n      .then((places) => {\n        TimesApp.setLoading(false);\n        if (places[0][\"place_id\"] !== undefined && places[0][\"coordinates\"][\"lat\"] !== null) {\n          TimesApp.setPlaceOnMap(places);\n          TimesApp.lMap.setView([places[0][\"coordinates\"][\"lat\"], places[0][\"coordinates\"][\"lng\"]], TimesApp.zoom);\n          TimesApp.mapMarkers[places[0][\"place_id\"]].fireEvent('click');\n        } else {\n          alert(\"You need to specify the full address of a place.\");\n        }\n      })\n      .catch((r) => Utils.sendError({\n        url: fetchUrl,\n        singlePlace: true,\n        message: r.toString()\n      }));\n  },\n  getPlacesFallback: async function() {\n    const fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.getPlacesAPI.replace('api-geo-fr', 'api-geo-uk').replace('api-geo-ny', 'api-geo-uk'), TimesApp.query, TimesApp.address);\n    ga('send', 'event', 'Request', 'Places', TimesApp.address);\n    fetch(fetchUrl)\n      .then((r) => {\n        if (r.ok) return r.json();\n      })\n      .then((places) => TimesApp.setPlaceOnMap(places))\n      .catch((r) => Utils.sendError({\n        url: fetchUrl,\n        message: r.toString()\n      }));\n  },\n  getPlaces: function(query, useFallback) {\n    var query = query || TimesApp.query;\n    var useFallback = useFallback || false;\n    TimesApp.setLoading(true);\n    // const fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.getPlacesAPI, query, TimesApp.address, TimesApp.lat, TimesApp.lng);\n    if (useFallback) {\n      var headers = new Headers();\n      headers.append('x-geo-lat', TimesApp.lat);\n      headers.append('x-geo-lng', TimesApp.lng);\n      const fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.getPlacesAPIFallback, query, TimesApp.address);\n      ga('send', 'event', 'Request', 'Places', TimesApp.address);\n      fetch(fetchUrl, {\n          headers: headers\n        })\n        .then((r) => {\n          if (r.ok) return r.json();\n        })\n        .then((places) => {\n          TimesApp.startBoundIndex = places.length <= 40 ? 120 : 361;\n          TimesApp.setPlaceOnMap(places);\n          TimesApp.updateBound(TimesApp.lat, TimesApp.lng);\n        })\n        .catch((r) => TimesApp.getPlacesFallback());\n    } else {\n      var placeUrl = WaitingTimesAPI.getPlacesAPI;\n      // if (Math.floor(Math.random() * 21) == 10)\n      //   placeUrl = placeUrl.replace('api-geo-fr', 'api-geo-uk');\n\n      const fetchUrl = WaitingTimesAPI.format(placeUrl, query, TimesApp.address);\n      ga('send', 'event', 'Request', 'Places', TimesApp.address);\n      fetch(fetchUrl)\n        .then((r) => {\n          if (r.ok) return r.json();\n        })\n        .then((places) => TimesApp.setPlaceOnMap(places))\n        .catch((r) => TimesApp.getPlacesFallback());\n    }\n\n  },\n  setPlaceOnMap: function(places) {\n    console.log(places);\n    TimesApp.setLoading(false);\n    var pointMarkers = [];\n    var tmpMenuPlaces = {};\n    if (TimesApp.menuPlaces >= 140) {\n      TimesApp.menuPlaces = {};\n    }\n\n    for (const key in places) {\n      // if (places[key][\"populartimes\"] === undefined) continue;\n\n      var waitTimeArr = TimesApp.getWaitTime(places[key]);\n\n      var waitTime = waitTimeArr[1];\n      // var radius = waitTime + 80;\n      var colors = TimesApp.getMarkerPlaceColor(waitTime);\n      var message = \"<b>\" + places[key][\"name\"] + \"</b><br><small>\" + places[key][\"address\"] + \"</small><br/><i>\" + waitTime + \"min</i> of line\";\n\n      // if (isNaN(radius)) radius = 80;\n\n      if (waitTimeArr[0] === 0) {\n        colors = [\"7\", \"#777\"];\n        // radius = 80;\n        message = \"<i>Closed</i><br/>\" + message;\n      }\n      \n      if (places[key][\"user_feedback\"] !== undefined && places[key][\"user_feedback\"][\"estimate_wait_min\"] !== undefined) {\n        waitTime = places[key][\"user_feedback\"][\"estimate_wait_min\"];\n        waitTimeArr[1] = waitTime;\n        colors = TimesApp.getMarkerPlaceColor(waitTime);\n        places[key][\"updatetime\"] = places[key][\"user_feedback\"][\"updatetime\"];\n      }\n\n      if (places[key][\"updatetime\"] !== undefined) {\n        var date = new Date(places[key][\"updatetime\"] * 1000);\n        var hours = date.getHours();\n        var minutes = \"0\" + date.getMinutes();\n        var formattedTime = hours + ':' + minutes.substr(-2);\n        message += \" - <i>Last update at</i> \" + formattedTime;\n      }\n      \n      var icon = (typeof(waitTime) === 'string' && colors[0] != '7') ? TimesApp.icons[8] : TimesApp.icons[colors[0]];\n\n      const pointMarker = L.marker([places[key][\"coordinates\"][\"lat\"], places[key][\"coordinates\"][\"lng\"]], {\n        icon: icon\n      });\n\n      if (TimesApp.place_ids.indexOf(places[key][\"place_id\"]) !== -1) {\n        TimesApp.mapMarkers[places[key][\"place_id\"]].setIcon(icon);\n        TimesApp.mapMarkers[places[key][\"place_id\"]].removeEventListener(\"click\");\n        TimesApp.menuPlaces[places[key][\"place_id\"]] = {data: places[key], waitTimeArr: waitTimeArr};\n      }\n      \n      // pointMarker.bindPopup(message);\n      pointMarker.addTo(TimesApp.lMap).on('click', function () {\n        Utils.showPlaceModal(places[key][\"place_id\"]);\n      });\n      pointMarkers.push(pointMarker);\n      tmpMenuPlaces[places[key][\"place_id\"]] = {data: places[key], waitTimeArr: waitTimeArr};\n      TimesApp.mapMarkers[places[key][\"place_id\"]] = pointMarker;\n\n      TimesApp.place_ids.push(places[key][\"place_id\"]);\n    }\n\n    if (Object.keys(tmpMenuPlaces).length > 0)\n      TimesApp.menuPlaces = Object.assign(tmpMenuPlaces, TimesApp.menuPlaces);\n    return pointMarkers;\n  },\n  updateAddressAwait: async function() {\n    var r = await fetch(WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPI, TimesApp.lat, TimesApp.lng));\n    r = (r.ok) ? await r.json() : {\n      staddress: '',\n      city: ''\n    };\n    r.staddress = (typeof(r.staddress) === 'object' || r.staddress === undefined) ? '' : r.staddress;\n    r.city = (typeof(r.city) === 'object' || r.city === undefined) ? '' : r.city;\n\n    TimesApp.address = (r.staddress !== '') ? r.staddress + ', ' : '';\n    TimesApp.address += r.city;\n    TimesApp.getPlaces();\n    ga('send', 'event', 'Request', 'Geocode', WaitingTimesAPI.geocodeAPI);\n  },\n  updateAddress: async function() {\n    var fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPIClient, TimesApp.lng, TimesApp.lat);\n    var keyUrl = 1;\n    if (Math.floor(Math.random() * 15) == 5) {\n      keyUrl = 0;\n      fetchUrl = WaitingTimesAPI.format(WaitingTimesAPI.geocodeAPI, TimesApp.lat, TimesApp.lng);\n    }\n\n    var r = await fetch(fetchUrl);\n    var json = {\n      staddress: '',\n      city: ''\n    };\n    if ((r.ok)) {\n      json = await r.json();\n    } else {\n      var error = await r.json();\n      Utils.sendError({\n        url: fetchUrl,\n        updateAddress: true,\n        message: error.toString()\n      });\n      return false;\n    }\n\n    json.staddress = (typeof(json.staddress) === 'object' || json.staddress === undefined) ? '' : json.staddress;\n    json.city = (typeof(json.city) === 'object' || json.city === undefined) ? '' : json.city;\n\n    if (json.staddress === '' && json.address !== undefined)\n      json.staddress = (json.address[\"Address\"] === undefined) ? '' : json.address[\"Address\"];\n\n    if (json.city === '' && json.address !== undefined)\n      json.city = (json.address[\"City\"] === undefined) ? '' : json.address[\"City\"];\n\n    TimesApp.address = (json.staddress !== '') ? json.staddress + ', ' : '';\n    TimesApp.address += json.city;\n    TimesApp.getPlaces(null, true);\n\n    ga('send', 'event', 'Request', 'Geocode', ((keyUrl == 0) ? WaitingTimesAPI.geocodeAPI : WaitingTimesAPI.geocodeAPIClient));\n  },\n  updateBound: async function(originLat, originLng) {\n    TimesApp.setLoading(true);\n    for (var i = 361; i <= 360; i += 120) {\n      var destLatLng = Utils.destinationPoint(originLat, originLng, i, 2.5);\n      TimesApp.lat = parseFloat(destLatLng[0]);\n      TimesApp.lng = parseFloat(destLatLng[1]);\n\n      await new Promise(resolve => setTimeout(resolve, 3000));\n      await TimesApp.updateAddress(-1);\n    }\n    TimesApp.setLoading(false);\n  },\n  geoSuccess: async function(position) {\n    if (position === undefined) {\n      TimesApp.geoError();\n      return false;\n    }\n    TimesApp.toggleSpinner();\n    TimesApp.lat = parseFloat(position.coords.latitude);\n    TimesApp.lng = parseFloat(position.coords.longitude);\n    TimesApp.lMap.setView([TimesApp.lat, TimesApp.lng], TimesApp.zoom);\n\n    await TimesApp.updateAddress();\n    await TimesApp.updateBound(TimesApp.lat, TimesApp.lng);\n    ga('send', 'event', 'Geolocation', 'GeoSuccess', 'true');\n  },\n  showModalHelp: function() {\n    if (document.querySelector('.modal') !== null)\n      document.body.removeChild(document.querySelector('.modal'));\n    Utils.openModal(\"help-modal\", \"Need help? Do you want to ask something?\");\n  },\n  sendReview: function(rate) {\n    var rate = rate || '0';\n    ga('send', 'event', 'Review', 'Rate', rate);\n    Utils.sendError({\n      rate: rate\n    });\n    localStorage.setItem(\"sended_review\", \"yes\");\n    document.querySelector('.modal-content div.container').innerHTML = '<h2>Feedback sent, thank you!</h2>';\n    setTimeout(function() {\n      document.body.removeChild(document.getElementById('rating-modal'));\n    }, 1200);\n  },\n  sendHelp: function(message, email) {\n    var email = email || \"\";\n\n    if (message != '' && email != '') {\n      Utils.sendError({\n        message: message,\n        email: email,\n        help: true\n      });\n    }\n\n    document.querySelector('.modal-content div.container').innerHTML = '<h2>Message sent, thank you!</h2>';\n    setTimeout(function() {\n      Utils.closeModal('help-modal');\n    }, 1200);\n  },\n  fallbackGeocodeCall: async function(address) {\n    var r = await fetch(WaitingTimesAPI.format(WaitingTimesAPI.fallbackGeocodeAPI, address));\n    var json = await r.json();\n\n    if (json[\"candidates\"] !== undefined && json[\"candidates\"].length > 0) {\n      json['latt'] = json[\"candidates\"][0]['location']['y'];\n      json['longt'] = json[\"candidates\"][0]['location']['x'];\n    } else {\n      json[\"error\"] = true;\n    }\n\n    return json;\n  },\n  search: async function(ask) {\n    var ask = ask || true;\n    if (ask === true)\n      TimesApp.address = prompt(\"This app need your gps position or at least your address or your city:\", \"\");\n\n    if (TimesApp.address === null)\n      return false;\n\n    TimesApp.setLoading(true);\n    if (TimesApp.address != \"\") {\n      ga('send', 'event', 'Request', 'Search', TimesApp.address);\n      const fetchUrl = \"https://geocode.xyz/\" + TimesApp.address + \"?json=1\";\n\n      var r = await fetch(fetchUrl);\n      var json = await r.json();\n      if (!r.ok || (json['error'] !== undefined && json['error']['code'] === '006')) {\n        json = await TimesApp.fallbackGeocodeCall(TimesApp.address);\n      }\n\n      if (json[\"error\"] !== undefined) {\n        setTimeout(function() {\n          alert(\"No results. Check your address/city and try again. Please write the city in english\");\n          Utils.sendError({\n            url: fetchUrl,\n            search: true,\n            message: json[\"error\"]\n          });\n          Utils.openSuggestModal();\n        }, 2000);\n        return false;\n      }\n\n      TimesApp.lat = parseFloat(json.latt);\n      TimesApp.lng = parseFloat(json.longt);\n      TimesApp.getPlaces(null, true);\n      TimesApp.lMap.setView([TimesApp.lat, TimesApp.lng], TimesApp.zoom);\n      TimesApp.updateBound(TimesApp.lat, TimesApp.lng);\n    }\n  },\n  promptAddress: function() {\n    return prompt(\"This app need your gps position or at least your address or your city:\", \"\");\n  },\n  geoError: async function(e) {\n    TimesApp.toggleSpinner();\n    Utils.openSuggestModal();\n  },\n  initGeodata: function () {\n    TimesApp.toggleSpinner();\n    Utils.getAccurateCurrentPosition(\n      TimesApp.geoSuccess,\n      TimesApp.geoError,\n      function (p) {\n        console.log(p);\n      }, {\n        desiredAccuracy: 100,\n        maxWait: 8000\n      }\n    );\n  },\n  toggleSpinner: function() {\n    const spinnerEl = document.getElementById('loading');\n    var displayProp = 'block';\n    if (spinnerEl.style.display == 'block')\n      displayProp = 'none';\n\n    spinnerEl.style.display = displayProp;\n  }\n};\n\n\n// DOMContentLoaded\n\ndocument.addEventListener('DOMContentLoaded', function () {\n  const mapEl = document.getElementById('full-map');\n  mapEl.style.height = window.innerHeight + 'px';\n\n  TimesApp.initMap(-1);\n  if (Utils.shouldShowWelcomeModal()) {\n    Utils.showWelcomeModal();\n  } else if (last_address === null) {\n    TimesApp.initGeodata();\n  } else {\n    TimesApp.getPlaces(null, true);\n  }\n\n  /*setTimeout(function () {\n    document.getElementById('banner').style.display = \"none\";\n  }, 30 * 1000);*/\n\n  // Auto-refresh\n  setTimeout(function () {\n    TimesApp.getPlaces(null, true);\n  }, 5 * 60 * 1000);\n\n  if (localStorage.getItem('sended_review') !== 'yes') {\n    setTimeout(function () {\n      Utils.openModal('rating-modal', 'Please, take time to rate this project', `\n        <h4>Your feedback is very important to understand if the estimates are correct or not. Together we can build something useful!</h4>\n        <div class=\"rate\">\n          <input type=\"radio\" id=\"star5\" name=\"rate\" value=\"5\">\n          <label onclick=\"TimesApp.sendReview(this.getAttribute('data-value'))\" for=\"star5\" data-value=\"5\" title=\"5 stars\"><span class='sr-only'>5 stars</span></label>\n          <input type=\"radio\" id=\"star4\" name=\"rate\" value=\"4\">\n          <label onclick=\"TimesApp.sendReview(this.getAttribute('data-value'))\" for=\"star4\" data-value=\"4\" title=\"4 stars\"><span class='sr-only'>4 stars</span></label>\n          <input type=\"radio\" id=\"star3\" name=\"rate\" value=\"3\">\n          <label onclick=\"TimesApp.sendReview(this.getAttribute('data-value'))\" for=\"star3\" data-value=\"3\" title=\"3 stars\"><span class='sr-only'>3 stars</span></label>\n          <input type=\"radio\" id=\"star2\" name=\"rate\" value=\"2\">\n          <label onclick=\"TimesApp.sendReview(this.getAttribute('data-value'))\" for=\"star2\" data-value=\"2\" title=\"2 stars\"><span class='sr-only'>2 stars</span></label>\n          <input type=\"radio\" id=\"star1\" name=\"rate\" value=\"1\">\n          <label onclick=\"TimesApp.sendReview(this.getAttribute('data-value'))\" for=\"star1\" data-value=\"1\" title=\"1 star\"><span class='sr-only'>1 star</span></label>\n        </div>\n      `, -1);\n    }, 120 * 1000);\n  }\n});\n\nwindow.onerror = function(errorMessage, errorUrl, errorLine) {\n\n  const requestBody = {\n    date: (new Date()).toString(),\n    ua: navigator.userAgent,\n    errorMessage: errorMessage,\n    errorUrl: errorUrl,\n    errorLine: errorLine\n  };\n\n  Utils.sendError(requestBody);\n}\n\nwindow.addEventListener('appinstalled', function() {\n  ga('send', 'event', 'PWA', 'Installed', 'true');\n  Utils.sendError({\n    \"pwa_installed\": true\n  });\n});\n\n\n(function(i, s, o, g, r, a, m) {\n  i['GoogleAnalyticsObject'] = r;\n  i[r] = i[r] || function() {\n    (i[r].q = i[r].q || []).push(arguments)\n  }, i[r].l = 1 * new Date();\n  a = s.createElement(o),\n    m = s.getElementsByTagName(o)[0];\n  a.async = 1;\n  a.src = g;\n  m.parentNode.insertBefore(a, m)\n})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');\n\nga('create', 'UA-10999521-2', 'auto');\nga('set', 'anonymizeIp', true);\nga('send', 'pageview');\n\ntry {\n  navigator.serviceWorker.register('/sw.js');\n} catch (e) {\n  console.log(e);\n}\n"],"file":"main.js"}